# Ray Tracing I

æœ€è¿‘çœ‹åˆ°ä¸€ç¯‡æ–‡ç« [Ray Tracing in One Weekend](https://raytracing.github.io/books/RayTracingInOneWeekend.html)ï¼ˆå½“ç„¶è¿˜æœ‰next week å’Œ the rest of your life ç¬‘~ï¼‰ï¼Œ è®²è¿°äº†ä¸€å¼ å›¾ç‰‡çš„æ¸²æŸ“åŠå‘ˆç°è¿‡ç¨‹ï¼Œè§‰å¾—ç”šæ˜¯æœ‰è¶£ï¼Œç”±äºæ–‡ç« é‡Œæ˜¯ç”¨C++æ¥å®ç°çš„ï¼Œä¾¿ç”¨typescripté‡æ–°å®ç°äº†ä¸€éã€‚æˆ‘ä¼šæœ‰å°½é‡é€šä¿—çš„è¯­è¨€æ¥ç¿»è¯‘å’Œè®²è¿°[Ray Tracing in One Weekend](https://raytracing.github.io/books/RayTracingInOneWeekend.html)é‡Œçš„ä¸€äº›çŸ¥è¯†ç‚¹å’Œä»£ç å®ç°è¿‡ç¨‹ï¼Œä½†ä¾ç„¶å¸Œæœ›è¯»è€…æœ‰é«˜ä¸­æ°´å‡†çš„æ•°å­¦å’Œç‰©ç†ç´ å…»ï¼Œå¹¶ä¸”å¯¹ç¼–ç¨‹è¯­è¨€æœ‰ä¸€å®šäº†è§£ã€‚ä¾ç…§åŸæ–‡çš„è„‰ç»œåŠ ä¸Šç¬”è€…æœ¬äººçš„ç†è§£ï¼Œæˆ‘ä¼šæ•´ç†æˆä¸€ç³»åˆ—çš„æ–‡ç« ã€‚

ç¬¬ä¸€ç¯‡æ–‡ç« æˆ‘ä¼šæŠŠå®ƒåˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼Œå½“ä½ é˜…è¯»å®Œè¿™å‡ ä¸ªéƒ¨åˆ†åï¼Œåº”å½“å¯ä»¥ç†è§£Ray tracing é‡Œå…‰çº¿æˆåƒçš„åŸºæœ¬å»ºæ¨¡ã€‚
  - å›¾ç‰‡ç”Ÿæˆ
  - å‘é‡å·¥å…·ç±»
  - çƒçš„ç»˜åˆ¶

## å›¾ç‰‡ç”Ÿæˆ
è®¡ç®—æœºé‡Œä»»ä½•ä¸€ç§é¢œè‰²ï¼Œéƒ½å¯å®šä¹‰æˆä¸€ä¸ªå›ºå®šçš„æ•°å­—æˆ–å˜é‡ï¼Œè€Œ`RGB`æ˜¯å…¶ä¸­ä¸€ç§ç¼–ç æ–¹å¼ï¼Œæ¯ä¸€ä¸ªåƒç´ å¯ä»¥ç”¨ä¸‰ä¸ªå˜é‡æ¥è¡¨ç¤ºâ€”â€”R(çº¢è‰²ï¼‰G(ç»¿è‰²ï¼‰ä»¥åŠB(è“è‰²ï¼‰çš„å¼ºåº¦ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬å‘ä¸€ä¸ªæ–‡ä»¶é‡Œå†™å…¥ä¸€ç»„ç”±RGBç»„æˆçš„æ•°å€¼ï¼Œé‚£ä¹ˆè®¡ç®—æœºä¾¿å¯ä»¥è¯†åˆ«å‡ºè¿™ç»„æ•°å€¼æ‰€ä»£è¡¨çš„é¢œè‰²ã€‚æ¯”å¦‚ä¸€ä¸ªç®€å•çš„`PPM`æ ¼å¼çš„å›¾ç‰‡æ–‡ä»¶:
![ppm example](./images/ppm-example.jpg)

`ppm`æ ¼å¼çš„æ–‡ä»¶åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†ä¸ºå›¾ç‰‡çš„åŸºæœ¬å±æ€§çš„å®šä¹‰ï¼Œå¦ä¸€éƒ¨åˆ†å°±æ˜¯ä¸€ç»„RGBå€¼ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±æ¥å®šä¹‰ä¸€å¼ å®½200pxï¼Œ é«˜100pxçš„å›¾ç‰‡ã€‚
```ts
function main() {
  const nx = 200;
  const ny = 100;
  // å®šä¹‰å›¾ç‰‡å±æ€§
  stream.write("P3\n");
  stream.write(`${nx} ${ny}\n`);
  stream.write('255\n');
  // å®šä¹‰rgb
  for (let j = ny - 1; j >= 0; j--) {
    for (let i = 0; i < nx; i++) {
      const col: vec3 = Vec3.create(i / nx, j / ny, 0.2);
      const r = i / nx;
      const g = j / ny;
      const b = 0.2;
      const ir = Math.floor(255.99 * r);
      const ig = Math.floor(255.99 * g);
      const ib = Math.floor(255.99 * b);
      stream.write(`${ir} ${ig} ${ib}\n`);
    }
  }
}
```
åœ¨è¿™æ®µä»£ç é‡Œï¼š
- åƒç´ å€¼æŒ‰ç…§ä»å·¦åˆ°å³ï¼Œä»ä¸Šåˆ°ä¸‹çš„é¡ºåºè¢«å†™è¿›æ–‡ä»¶
- çº¢è‰²ä¸ç»¿è‰²æŒ‰ç…§å›¾ç‰‡çš„å®½å¸¦å’Œé«˜åº¦æ¸å˜ï¼Œè€Œç»¿è‰²åˆ™ä¿æŒä¸å˜ã€‚

æŠŠæ•°æ®å†™å…¥æ–‡ä»¶ä»¥åï¼Œæ‰“å¼€æ–‡ä»¶ï¼Œä¾¿ä¼šå‡ºç°ä¸‹é¢çš„å›¾ç‰‡ï¼š

![ppm](./images/ray.jpg)

ä¸€å¼ ppmæ ¼å¼å›¾ç‰‡æ¥è¯´ï¼Œå®ƒçš„ä¸»ä½“ä¾¿æ˜¯rgbçš„æ•°å€¼ï¼Œä½ æ”¹å˜å®ƒçš„æ•°å€¼ï¼Œä¾¿å‘ˆç°å‡ºä¸åŒçš„é¢œè‰²ã€‚

## å‘é‡å·¥å…·ç±»
åœ¨å¤§å¤šæ•°å›¾å½¢ç¼–ç¨‹é‡Œï¼Œéƒ½ä¼šä½¿ç”¨ä¸€äº›æ•°æ®ç»“æ„æ¥å­˜å‚¨å‡ ä½•å‘é‡å’Œé¢œè‰²ï¼ˆåœ¨GPUé‡Œï¼ŒçŸ©é˜µçš„è¿ç®—å¯ä»¥å¹¶è¡Œè¿›è¡Œï¼‰ï¼Œæ¯”å¦‚RGBè‰²å€¼ï¼Œå®šç‚¹ä½ç½®ï¼Œæ–¹å‘ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¾è®¡ä¸€ä¸ª`vec3`çš„ç±»æ¥å¯¹è¿™äº›æ•°æ®è¿›è¡Œå­˜å‚¨å’Œè®¡ç®—ã€‚å¯¹äº`vec3`ï¼Œæˆ‘ä»¬éœ€è¦
  - å®šä¹‰ç±»å‹
  - å®šä¹‰è¿ç®—

å…¶ä¸­æœ€ä¸ºé‡è¦çš„ä¾¿æ˜¯å®šä¹‰`vec3`çš„è¿ç®—ã€‚

å¯¹äºç±»å‹å®šä¹‰ï¼Œso easy emmmm
```ts
export type vec3 = [number, number, number];
```
ç„¶åæ˜¯å®šä¹‰vec3çš„è¿ç®—ï¼Œç”±äºtypescriptæ²¡æ³•å¯¹æ“ä½œç¬¦è¿›è¡Œé‡è½½ï¼Œåªèƒ½è€è€å®å®çš„æŠŠæ¯ä¸€ä¸ªè¿ç®—å®šä¹‰ä¸ºä¸€ä¸ªæ–¹æ³•ã€‚æˆ‘ä»¬å¯èƒ½éœ€è¦å®šä¹‰å‘é‡åŠ æ³•ï¼Œå‘é‡çš„å‡æ³•ï¼Œä¹˜æ³•(dot)ï¼Œé™¤æ³•å’Œå‰ä¹˜(cross)ï¼Œ ä»¥åŠæ±‚å‘é‡çš„é•¿åº¦å’Œå•ä½å‘é‡å’Œä¸€äº›è¾…åŠ©å‡½æ•°ã€‚å…·ä½“å®ç°å¯ä»¥çœ‹æˆ‘githubä¸Šçš„[ä»£ç ](https://github.com/MicleMing/ICG-WebGL2/blob/master/src/chapter03/ray-tracker/vec3.ts)
```ts
export class Vec3 {
  static x = (v: vec3) => v[0];
  static y = (v: vec3) => v[1];
  static z = (v: vec3) => v[2];
  static r = (v: vec3) => v[0];
  static g = (v: vec3) => v[1];
  static b = (v: vec3) => v[2];

  static create(v0?: number, v1?: number, v2?: number): vec3;
  static multiply(a: vec3, t: number): vec3;
  static multiply(a: vec3, b: vec3): vec3;
  static add(a: vec3, b: vec3): vec3;
  static substract(a: vec3, b: vec3);
  static devide(a: vec3, t: number): vec3;
  static devide(a: vec3, b: vec3): vec3;
  static dot(a: vec3, b: vec3): number;
  static len(v: vec3): number;
  static unit_vector(v: vec3): vec3;
  static squard_length(v: vec3): number;
  static square(v: vec3): vec3;
  static cross(v1: vec3, v2: vec3): vec3;
}

```

é¡ºä¾¿æä¸€ä¸‹ï¼Œ`cross`è¿ç®—ä¾¿æ˜¯æ±‚ä¸¤ä¸ªå‘é‡çš„æ³•å‘é‡ emmm

æœ‰äº†`vec3`åï¼Œä¾¿å¯ä»¥å¯¹ç¬¬ä¸€éƒ¨åˆ†çš„ä»£ç è¿›è¡Œé‡æ„
```ts
  for (let j = ny - 1; j >= 0; j--) {
    for (let i = 0; i < nx; i++) {
      const col: vec3 = Vec3.create(i / nx, j / ny, 0.2);
      const ir = Math.floor(255.99 * col[0]);
      const ig = Math.floor(255.99 * col[1]);
      const ib = Math.floor(255.99 * col[2]);
      stream.write(`${ir} ${ig} ${ib}\n`);
    }
  }
```
è¿™æ ·ä¾¿å°†é¢œè‰²ç”¨å‘é‡è¿›è¡Œè¿ç®—ã€‚åœ¨è¿™é‡Œçœ‹èµ·æ¥ç”¨`vec3`è¿›è¡Œé‡æ„æ˜¾å¾—å¤šæ­¤ä¸€ä¸¾ï¼Œä½†æ˜¯åé¢å°±çŸ¥é“å®ƒçš„å¥½å¤„äº†ï¼Œè¦çŸ¥é“çš„æ˜¯åœ¨å›¾å½¢ç¼–ç¨‹é‡Œï¼Œä¼šç”¨åˆ°å¤§é‡çš„çŸ©é˜µè¿ç®—ï¼Œæ‰€ä»¥ä¸€å¼€å§‹ç”¨å‘é‡çš„æ•°æ®ç»“æ„æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚

## çƒçš„ç»˜åˆ¶
æƒ³è±¡ä¸€ä¸‹ï¼Œå…‰çº¿ç…§åœ¨ä¸€ä¸ªçƒä½“ä¸Šæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿå—¯ï¼Œå…‰çº¿å‡»ä¸­çƒçš„ä½ç½®ï¼Œç„¶åå‘ˆç°å‡ºçƒçš„é¢œè‰²ã€‚æ‰€ä»¥åœ¨ç»˜åˆ¶çƒä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åšä¸¤ä»¶äº‹
  - å¯¹å…‰çº¿çš„è½¨è¿¹è¿›è¡Œæè¿°
  - è®¡ç®—å…‰çº¿åœ¨è½¨è¿¹ä¸ŠæŸä¸ªç‚¹çš„é¢œè‰²

åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œå…‰çº¿ä»ä¸€ä¸ªå…‰æºå°„å‡ºï¼Œæ²¿ç€ä¸€æ¡ç›´çº¿è¿›è¡Œä¼ æ’­ï¼Œæ‰€ä»¥å¯¹äºå…‰çº¿çš„è¿åŠ¨è½¨è¿¹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæ•°å­¦è¡¨è¾¾å¼æè¿°:
> ğ‘(ğ‘¡)=ğ´+ğ‘¡âˆ—ğµ

å…¶ä¸­ï¼Œ`A`ä»£è¡¨çš„æ˜¯å…‰æºçš„ä½ç½®ï¼Œç±»å‹ä¸º`vec3`ï¼› `B`ä»£è¡¨å…‰çš„ä¼ æ’­æ–¹å‘ï¼Œç±»å‹ä¸º`vec3`ï¼Œ`t`æ˜¯ä¸€ä¸ªç³»æ•°ï¼Œæ˜¯ä¸€ä¸ªç®€å•çš„æ•°å€¼ç±»å‹. å¯¹äºè¿™ä¸ªæ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª`class`æ¥è¡¨ç¤º:

```ts
class Ray {
  A: vec3;
  B: vec3;
  constructor(a: vec3, b: vec3) {
    this.A = a;
    this.B = b;
  }
  origin(): vec3 {
    return this.A;
  }
  direction(): vec3 {
    return this.B;
  }
  point_at_parameter(t: number) {
    // p(t) = A + t * B
    return Vec3.add(this.A, Vec3.multiply(this.B, t));
  }
}
```
æœ‰äº†å…‰çº¿çš„è½¨è¿¹æ¨¡å‹åï¼Œå°±å¯ä»¥å»è®¡ç®—åœ¨è½¨è¿¹ä¸Šå…‰çš„é¢œè‰²äº†ï¼ˆåœ¨è¿™é‡Œæˆ‘ä»¬å…ˆä»¥çº¿æ€§æ¸å˜åšä¾‹å­ï¼‰ã€‚ä¸ºæ­¤éœ€è¦å»ºç«‹ä¸€ä¸ªåæ ‡ç³»ã€‚
![eye](./images/fig-1-04-2.jpg)ã€‚

å¯¹æ­¤æˆ‘ä»¬å…ˆåšå‡ ä¸ªå‡è®¾ï¼š
  - å…‰æºçš„ä½ç½®æ˜¯vec3(0, 0, 0)
  - å…‰ä¼šæ‰“åœ¨å‰æ–¹ï¼ˆz è½´çš„è´Ÿæ–¹å‘ )çš„ä¸€å—åŒºåŸŸ
  - å…‰çº¿ä¸€å¼€å§‹çš„é¢œè‰²æ˜¯ç™½è‰²vec3(1 ,1, 1), é€æ¸å‘è“è‰²vec3(0.5, 0.7, 1.0)è¿‡æ¸¡

å¯¹äºçº¿æ€§æ¸å˜æ¥è¯´ï¼Œå®ƒæ˜¯ç¬¦åˆæ¸å˜å‡½æ•°çš„:
> ğ‘ğ‘™ğ‘’ğ‘›ğ‘‘ğ‘’ğ‘‘ğ‘‰ğ‘ğ‘™ğ‘¢ğ‘’=(1âˆ’ğ‘¡)âˆ—ğ‘ ğ‘¡ğ‘ğ‘Ÿğ‘¡ğ‘‰ğ‘ğ‘™ğ‘¢ğ‘’+ğ‘¡âˆ—ğ‘’ğ‘›ğ‘‘ğ‘‰ğ‘ğ‘™ğ‘¢ğ‘’,

æ‰€ä»¥æˆ‘ä»¬ä¾¿å¯ä»¥åˆ©ç”¨è¿™ä¸ªå‡½æ•°å¯¹å…‰çº¿çš„é¢œè‰²è¿›è¡Œå»ºæ¨¡, ä¸ºæ­¤å¯ä»¥ç”¨ä¸€ä¸ª`function`æ¥è¡¨ç¤º:
```ts
function color(ray: Ray): vec3 {
  // unit vector(a) = A / |A|
  const unit_direction: vec3 = Vec3.unit_vector(ray.direction());
  const t = 0.5 * (Vec3.y(unit_direction) + 1);
  // ğ‘ğ‘™ğ‘’ğ‘›ğ‘‘ğ‘’ğ‘‘ğ‘‰ğ‘ğ‘™ğ‘¢ğ‘’=(1âˆ’ğ‘¡)âˆ—ğ‘ ğ‘¡ğ‘ğ‘Ÿğ‘¡ğ‘‰ğ‘ğ‘™ğ‘¢ğ‘’+ğ‘¡âˆ—ğ‘’ğ‘›ğ‘‘ğ‘‰ğ‘ğ‘™ğ‘¢ğ‘’,
  // when t = 1.0 => blue, when t = 0 => white
  return Vec3.add(
    Vec3.multiply([1.0, 1.0, 1.0], 1.0 - t),
    Vec3.multiply([0.5, 0.7, 1.0], t)
  );
}
```
æœ‰äº†å…‰çº¿è½¨è¿¹ï¼Œæœ‰äº†æå–å…‰çº¿é¢œè‰²çš„å‡½æ•°ï¼Œè‡ªç„¶è€Œç„¶ï¼Œä¾¿å¯ä»¥æ¨¡æ‹Ÿå…‰çº¿ç…§å°„æ—¶æœ€ç®€å•çš„æƒ…å†µï¼Œæˆ‘ä»¬æŠŠè¿™ä¸¤ä¸ªå‡½æ•°å¸¦å…¥æˆ‘ä»¬ä¹‹å‰ç”Ÿæˆå›¾ç‰‡çš„é‚£ä¸ª`main`å‡½æ•°:
```ts
  const lower_left_corner = Vec3.create(-2.0, -1.0, -1.0);
  const horizontal = Vec3.create(4.0, 0.0, 0.0);
  const vertical = Vec3.create(0.0, 2.0, 0.0);
  const origin = Vec3.create(0.0, 0.0, 0.0);

  for (let j = ny - 1; j >= 0; j--) {
    for (let i = 0; i < nx; i++) {
      const u = i / nx;
      const v = j / ny;
      const r = new Ray(
        origin,
        // direction: lower_left_corner + u*horizontal + v*vertical
        Vec3.add(
          Vec3.add(lower_left_corner, Vec3.multiply(horizontal, u)),
          Vec3.multiply(vertical, v)
        )
      );
      const col: vec3 = color(r);
      const ir = Math.floor(255.99 * col[0]);
      const ig = Math.floor(255.99 * col[1]);
      const ib = Math.floor(255.99 * col[2]);
      stream.write(`${ir} ${ig} ${ib}\n`);
    }
  }
```
è¿™æ ·ä¾¿æœ‰äº†ä¸€ä¸ªç”±è“è‰²åˆ°ç™½è‰²çš„æ¸å˜å›¾ç‰‡ã€‚
![leaner](./images/img-1-04-1.jpg)

å‰ç½®æ¡ä»¶æœ‰äº†ï¼Œä¾¿å¯ä»¥å¼€å§‹æ„‰å¿«çš„ç”»ä¸€ä¸ªå…‰çº¿æ’å‡»åœ¨åœ†ä¸Šçš„æ•ˆæœï¼Œå›é¡¾ä¸€ä¸‹é«˜ä¸­æ—¶å­¦çš„åœ†çš„çŸ¥è¯†ï¼šï¼‰ï¼Œ å¦‚ä½•ç”¨æ•°å­¦çš„æ–¹å¼æ¥è¡¨ç¤ºä¸€ä¸ªåœ†ï¼Ÿå“¦ï¼Œæœ‰ä¸€ä¸ªåœ†çš„æ–¹ç¨‹ã€‚ åœ†ç”±åœ†å¿ƒå’ŒåŠå¾„æ„æˆï¼Œæœ‰äº†åœ†å¿ƒåæ ‡å’ŒåŠå¾„ï¼Œä¾¿å¯ä»¥ç¡®å®šä¸€ä¸ªåœ†ï¼Œ å‡è®¾åœ†å¿ƒåæ ‡(Cx, Cy, Cz), åŠå¾„ä¸ºRï¼Œé‚£ä¹ˆåœ†çš„è½¨è¿¹æ–¹ç¨‹ä¸ºï¼š
> (ğ‘¥âˆ’ğ¶ğ‘¥)2+(ğ‘¦âˆ’ğ¶ğ‘¦)^2+(ğ‘§âˆ’ğ¶ğ‘§)^2=ğ‘…^2 å…¶ä¸­ P = (x, y, z)

æˆ‘ä»¬çŸ¥é“Pä¸ºåœ†ä¸Šä»»æ„ä¸€ç‚¹ï¼Œ åœ¨å›¾å½¢ç¼–ç¨‹é‡Œï¼Œé€šå¸¸éœ€è¦è½¬æ¢æˆå‘é‡çš„å½¢å¼
> ğ‘ƒ=(ğ‘¥,ğ‘¦,ğ‘§)  = (ğ‘âˆ’ğ¶)

å› æ­¤ï¼Œå¯¹äºåœ†çš„æ–¹ç¨‹ï¼Œå¯ä»¥è¡¨ç¤ºä¸ºï¼š
> ğ‘‘ğ‘œğ‘¡((ğ‘âˆ’ğ¶),(ğ‘âˆ’ğ¶))=(ğ‘¥âˆ’ğ¶ğ‘¥)^2+(ğ‘¦âˆ’ğ¶ğ‘¦)^2+(ğ‘§âˆ’ğ¶ğ‘§)^2 = R^2

æœ‰äº†è¿™ä¸ªåœ†çš„æ–¹ç¨‹ï¼Œé‚£ä¹ˆæ€ä¹ˆä¸æˆ‘ä»¬çš„å…‰çº¿ç»“åˆåœ¨ä¸€èµ·å‘¢ï¼Ÿè¿˜è®°å¾—ä¹‹å‰å…‰çº¿çš„è½¨è¿¹æ–¹ç¨‹ä¹ˆï¼Ÿ
> p(t) = A + t * B

å¦‚æœå…‰çº¿æ‰“åœ¨äº†åœ†ä¸Šï¼Œé‚£ä¹ˆè¯´æ˜ p(t) = Pï¼Œ å¸¦å…¥åœ†çš„æ–¹ç¨‹ï¼Œå¾—å‡ºï¼š
> ğ‘‘ğ‘œğ‘¡((ğ‘(ğ‘¡)âˆ’ğ¶),(ğ‘(ğ‘¡)âˆ’ğ¶))=ğ‘…^2

å±•å¼€ä¹‹åä¸ºï¼š
> ğ‘‘ğ‘œğ‘¡((ğ´+ğ‘¡âˆ—ğµâˆ’ğ¶),(ğ´+ğ‘¡âˆ—ğµâˆ’ğ¶))=ğ‘…^2

ç»§ç»­å±•å¼€ä¸ºå…³äº`t`çš„ä¸€èˆ¬æ–¹ç¨‹ï¼š
> ğ‘¡^2â‹…ğ‘‘ğ‘œğ‘¡(ğµ,ğµ)+2ğ‘¡â‹…ğ‘‘ğ‘œğ‘¡(ğµ,ğ´âˆ’ğ¶)+ğ‘‘ğ‘œğ‘¡(ğ´âˆ’ğ¶,ğ´âˆ’ğ¶)âˆ’ğ‘…^2=0

å¦‚æœè¿™ä¸ªæ–¹ç¨‹æœ‰æœ‰è§£ï¼Œé‚£ä¹ˆå°±æ˜¯å…‰çº¿æ‰“åœ¨äº†åœ†ä¸Š, è¿˜è®°å¾—æ€ä¹ˆåˆ¤å®šä¸€ä¸ªä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹æœ‰è§£ä¹ˆï¼Ÿå“ˆå“ˆå“ˆï¼Œ b^2 - 4ac >= 0

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠä¸Šè¿°è¿‡ç¨‹ç”¨ä»£ç è¡¨ç¤º:
```ts
function hit_sphere(center: vec3, radius: number, r: Ray) {
  // ğ‘¡2â‹…ğ‘‘ğ‘œğ‘¡(ğµ,ğµ)+2ğ‘¡â‹…ğ‘‘ğ‘œğ‘¡(ğµ,ğ´âˆ’ğ¶)+ğ‘‘ğ‘œğ‘¡(ğ´âˆ’ğ¶,ğ´âˆ’ğ¶)âˆ’ğ‘…2=0
  const oc: vec3 = Vec3.substract(r.origin(), center);
  const a = Vec3.dot(r.direction(), r.direction());
  const b = 2 * Vec3.dot(oc, r.direction());
  const c = Vec3.dot(oc, oc) - radius * radius;
  const discriminant = b * b - 4 * a * c;
  return discriminant > 0;
}
```

ä¿®æ”¹ä¹‹å‰è·å–å…‰çº¿é¢œè‰²çš„å‡½æ•°:
```ts
function color(ray: Ray): vec3 {
  if (hit_sphere(Vec3.create(0, 0, -1), 0.5, ray)) {
    return Vec3.create(1, 0, 0);
  }
  const unit_direction: vec3 = Vec3.unit_vector(ray.direction());
  const t = 0.5 * (Vec3.y(unit_direction) + 1);

  return Vec3.add(
    Vec3.multiply([1.0, 1.0, 1.0], 1.0 - t),
    Vec3.multiply([0.5, 0.7, 1.0], t)
  );
}
```
è¿™æ ·ï¼Œå½“å…‰çº¿åœ¨åœ†å½¢åŒºåŸŸæ—¶ï¼Œç›´æ¥å˜æˆçº¢è‰²vec3(1, 0, 0);
![sphere](./images/img-1-05-1.jpg)

ç”±æ­¤ç¬¬ä¸€éƒ¨åˆ†å°±å®Œæˆäº†ï¼ŒåŒ…æ‹¬äº†å›¾ç‰‡ç”Ÿæˆï¼Œå…‰çº¿å»ºæ¨¡ï¼Œé¢œè‰²å–å€¼ç­‰ã€‚ä¹‹åä¾¿å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ ä¸€äº›å…‰çº¿çš„æ•ˆæœã€‚


